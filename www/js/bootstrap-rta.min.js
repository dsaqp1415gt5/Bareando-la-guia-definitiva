!function($){if(!Array.prototype.map){Array.prototype.map=function(fn,that){var i=0,ilen=this.length,resultA=[];for(;i<ilen;++i)resultA.push(fn.call(that,this[i],i,this));return resultA}}var plugin_name="rta",defaultButtons="bold italic underline strike,"+"ul ol, link image",allButtons="bold italic underline strike,"+"font-name font-size font-color font-bgcolor,"+"font-increase font-decrease,"+"superscript subscript,"+"align-left align-center align-right align-full,"+"indent-right indent-left,"+"ul ol,"+"link unlink image,"+"heading paragraph div hr,"+"h1 h2 h3 h4 h5 h6,"+"bgcolor,"+"remove-formatting html,",rxPlaceholder=/<span class=['"]?rta-placeholder['"]?>.*?<\/span>/i,isPlaceholder=function(str){return rxPlaceholder.test(str)},rxAllWhitespace=/^\s*$/,allWhitespace=function(str){return rxAllWhitespace.test(str)},rta=function(buttonStr,opts){$("textarea.rta")[plugin_name](buttonStr,opts)};function toggleHTML(btnName,event,button){return rta.toggleHTML(btnName,event,button)}function getLinkUrl(){return rta.getLinkUrl()}function getImageUrl(){return rta.getImageUrl()}function getFontColor(){return rta.getFontColor()}function getFontBgColor(){return rta.getFontBgColor()}function getHeading(){return rta.getHeading()}function getFontName(){return rta.getFontName()}function getFontSize(){return rta.getFontSize()}function getHTML(){return rta.getHTML()}function getBgColor(){return rta.getBgColor()}rta.winPrompt=function(label,defval){var val;if(typeof defval==="undefined"||defval===null)defval="";val=window.prompt(label,defval);if(val!==null){val=$.trim(val);if(val!==""){return val}}return null};rta.colorPrompt=function(label,defval){if(!label)label="HTML color string:";return rta.winPrompt("HTML color string:",defval)};rta.getLinkUrl=function(){return rta.winPrompt("url:","http://")};rta.getImageUrl=function(){return rta.winPrompt("Image url:","http://")};rta.getFontColor=function(){return rta.colorPrompt()};rta.getFontBgColor=function(){return rta.colorPrompt()};rta.getHeading=function(){var val=rta.winPrompt("HTML heading tag (h1, h2... h6):");if(val){val=val.toLowerCase();if(/h[1-6]/.test(val)){return val}}return null};rta.getFontName=function(){return rta.winPrompt("Font name (arial, etc.):")};rta.getFontSize=function(){var valStr=rta.winPrompt("Font size (1 to 7):"),valInt;if(valStr){valInt=parseInt(valStr);if(!isNaN(valInt)&&valInt>0&&valInt<8){return valInt}}return null};rta.getHTML=function(){return rta.winPrompt("HTML to enter:")};rta.getBgColor=function(){return rta.colorPrompt()};rta.toggleHTML=function(btnName,event,button){var iconGroup=$(button).closest(".rta-icon-group")[0],jta=$(iconGroup.rtaTextArea),je=$(iconGroup.rtaEditable);if(jta.css("display")==="none"){jta.show().focus();jta.width(je.width());jta.height(je.height());je.hide()}else{je.show();je.width(jta.width());je.height(jta.height());jta.hide()}};rta.buttonClick=function(btnName,event,button){var btn=rta.button[btnName],val=btn["value"],cmd=btn["cmd"];if($.isFunction(cmd)){cmd(btnName,event,button)}else if(typeof btn["cmd"]==="string"){if($.isFunction(val)){val=val(btnName,event);if(val===null){return}}if(cmd==="formatBlock"&&val.charAt(0)!=="<"){val="<"+val+">"}try{document.execCommand(cmd,false,val)}catch(e){}}};function btn(help,cmd,icon,value){if(!value)value="";if(!icon)icon="rtai-"+cmd;return{help:help,cmd:cmd,value:value,icon:icon}}rta.button={bold:btn("Bold","bold"),italic:btn("Italic","italic"),underline:btn("Underline","underline"),strike:btn("Strikethrough","strikeThrough","rtai-strike"),ul:btn("Unordered List","insertUnorderedList","rtai-ul"),ol:btn("Ordered List","insertOrderedList","rtai-ol"),link:btn("Hyperlink Selection","createLink","rtai-link",getLinkUrl),unlink:btn("Undo Hyperlink","unlink","rtai-unlink"),image:btn("Insert Image","insertImage","rtai-image",getImageUrl),"font-name":btn("Font Name","fontName","rtai-font-name",getFontName),"font-color":btn("Font Color","foreColor","rtai-font-color",getFontColor),"font-bgcolor":btn("Font Background Color","backColor","rtai-font-bgcolor",getFontBgColor),"font-size":btn("Font Size","fontSize","rtai-font-size",getFontSize),"font-increase":btn("Increase Font Size","increaseFontSize","rtai-font-increase"),"font-decrease":btn("Decrease Font Size","decreaseFontSize","rtai-font-decrease"),bgcolor:btn("Section Background Color","backColor","rtai-bgcolor",getBgColor),html:btn("Show/Hide HTML",toggleHTML,"rtai-html"),heading:btn("HTML Heading","formatBlock","rtai-heading",getHeading),h1:btn("H1 Heading","formatBlock","rtai-h1","h1"),h2:btn("H2 Heading","formatBlock","rtai-h2","h2"),h3:btn("H3 Heading","formatBlock","rtai-h3","h3"),h4:btn("H4 Heading","formatBlock","rtai-h4","h4"),h5:btn("H5 Heading","formatBlock","rtai-h5","h5"),h6:btn("H6 Heading","formatBlock","rtai-h6","h6"),paragraph:btn("Paragraph","formatBlock","rtai-paragraph","p"),div:btn("HTML div","formatBlock","rtai-div","div"),hr:btn("HTML hr","insertHorizontalRule","rtai-hr"),"align-left":btn("Align Left","justifyLeft","rtai-align-left"),"align-center":btn("Align Center","justifyCenter","rtai-align-center"),"align-right":btn("Align Right","justifyRight","rtai-align-right"),"align-full":btn("Align Full","justifyFull","rtai-align-full"),"indent-right":btn("Indent Right","indent","rtai-indent-right"),"indent-left":btn("Indent Left","outdent","rtai-indent-left"),superscript:btn("Superscript","superscript","rtai-superscript"),subscript:btn("Subscript","subscript","rtai-subscript"),"remove-formatting":btn("Remove Formatting","removeFormat","rtai-remove-formatting")};rta.defaultButtons=defaultButtons;rta.allButtons=allButtons;rta.options={twoway:false,btnsize:"mini"};$[plugin_name]=rta;$.fn[plugin_name]=function(param1,param2){return this.each(function(){var htmlA=[],jthis=$(this),btnStr=jthis.data("rta"),options=$.extend({},rta.options),inputEvents="input",placeholder=jthis.attr("placeholder"),p1Type=typeof param1,p2Type=typeof param2,buttonA;if(param1!==null&&p1Type==="object")$.extend(options,param1);else if(param2!==null&&p2Type==="object")$.extend(options,param2);if(jthis.data("rta-twoway")===true)options["twoway"]=true;if(jthis.data("rta-btnsize"))options["btnsize"]=jthis.data("rta-btnsize");if(!btnStr){if(p1Type==="string")btnStr=param1;else if(p2Type==="string")btnStr=param2;else btnStr=rta.defaultButtons}btnStr=btnStr.replace(/\s+/g," ").replace(/\s?,\s?/g,",").replace(/^\s|\s$/g,"");buttonA=btnStr.split(",").map(function(str){return str.split(" ")});htmlA.push('<div class="rta-group"><div class="rta-icon-group">');$.each(buttonA,function(i,btnGroupA){if(btnGroupA.length>0){htmlA.push('<div class="btn-group">');$.each(btnGroupA,function(i,btnName){if(btnName in rta.button){btn=rta.button[btnName];icon=btn["icon"];htmlA.push('<button class="btn btn-');htmlA.push(options["btnsize"]);htmlA.push('" type="button" data-rtabtn="');htmlA.push(btnName);htmlA.push('" title="');htmlA.push(btn["help"]);htmlA.push('">');if($.isFunction(icon)){htmlA.push(icon(btnName))}else{htmlA.push('<i class="');htmlA.push(icon);htmlA.push('"></i>')}htmlA.push("</button>")}});htmlA.push("</div>")}});htmlA.push('</div><div id="'+this.id+'-mirror" class="rta-editable" contenteditable="true"></div></div>');jthis.before(htmlA.join(""));var rtaGroup=jthis.prev(),iconGroup=$(" > .rta-icon-group",rtaGroup),rtaEditable=$(" > .rta-editable",rtaGroup);rtaEditable.width(jthis.width());rtaEditable.height(jthis.height());iconGroup.width(jthis.width());jthis.hide();rtaEditable.html(this.value);if(!("oninput"in rtaEditable[0]))inputEvents="keyup focus";rtaEditable.bind(inputEvents,function(){this.rtaTextArea.value=this.innerHTML});if(options.twoway){jthis.bind(inputEvents,function(){this.rtaEditable.innerHTML=this.value})}else{jthis.prop("readOnly",true)}iconGroup[0].rtaTextArea=this;iconGroup[0].rtaEditable=rtaEditable[0];rtaEditable[0].rtaIconGroup=iconGroup[0];rtaEditable[0].rtaTextArea=this;this.rtaIconGroup=iconGroup[0];this.rtaEditable=rtaEditable[0];iconGroup.click(function(event){var btnName=null,target=event.target,tagName=target.tagName.toLowerCase();while(target&&tagName!=="button"&&tagName!=="div"){target=target.parentNode;tagName=target.tagName.toLowerCase()}if(target&&tagName==="button"){btnName=$(target).data("rtabtn");if(btnName&&btnName in rta.button){rta.buttonClick(btnName,event,target)}if($(this.rtaEditable).css("display")!=="none"){this.rtaEditable.focus()}}});rtaEditable.bind("mouseup",function(event){$(this.rtaIconGroup).width($(this).width());$(this.rtaTextArea).width($(this).width());$(this.rtaTextArea).height($(this).height())});jthis.bind("mouseup",function(event){$(this.rtaIconGroup).width($(this).width());$(this.rtaEditable).width($(this).width());$(this.rtaEditable).height($(this).height())});jthis.closest(".control-group").find("label").prop("rtaEditable",rtaEditable[0]).click(function(event){if($(this.rtaEditable).css("display")!=="none"){this.rtaEditable.focus();event.preventDefault()}});function showPlaceholder(rtaEditable){var ta=rtaEditable.rtaTextArea;if(!rtaEditable.rtaPlaceholder&&(allWhitespace(ta.value)||isPlaceholder(ta.value))){rtaEditable.rtaPlaceholder=true;rtaEditable.innerHTML=rtaEditable.rtaPlaceholderHtml+rtaEditable.innerHTML}}if(placeholder){rtaEditable.prop("rtaPlaceholderHtml",'<span class="rta-placeholder">'+placeholder+"</span>");rtaEditable.prop("rtaPlaceholder",false);this.value=this.value.replace(rxPlaceholder,"");showPlaceholder(rtaEditable[0]);rtaEditable.bind("focus",function(event){if(this.rtaPlaceholder){this.rtaPlaceholder=false;this.innerHTML=this.innerHTML.replace(rxPlaceholder,"")}});rtaEditable.bind("blur",function(event){showPlaceholder(this)})}})}}(jQuery);